package newExam;
import java.util.*;

public class Scheduler {
	private List<Module> allModules = new ArrayList<Module>();
	private List<Day> allDays = new ArrayList<Day>();
	
	public Scheduler(List<Module> allModules, List<Day> allDays) {
		this.allModules = allModules;
		this.allDays = allDays;
	}
	
	//Backtrack Algorithm.
	public Boolean scheduleExam(Exam exam) {
		book(exam);
		for(Module module: allModules) {
			Exam nextExam = module.getExam();
			//Needs to have a check to see if the next Exam can be solved.
			if(nextExam.getScheduled() == false) {
			if(canBeScheduled(nextExam) == true){
				if(scheduleExam(nextExam)) {
					return true;
					}
				}
			}
		}
		removeHours(exam);
		exam.setScheduledFalse();
		exam = exam.returnBlank();
		return false;
	}
	
	 public void removeHours(Exam exam) {
		 if(exam.getStartTime() != null && exam.getEndTime() != null && exam.getDay() != null) {
		 for(int i = exam.getStartTime().getHour() ; i < exam.getEndTime().getHour() ; i++) {
			 Hour h = exam.getDay().getHour(i);
			 h.setAvailableTrue();
		 }
		 //exam = exam.returnBlank();
		 //startTime.setAvailableTrue();
		 //endTime.setAvailableTrue();
		 }
	 }
	
	 public Boolean canBeScheduled(Exam exam) {
		 for(Day day : allDays) {
				for(Hour start : day.getHours()) {
					if(start.getAvailable() == true) {
						start.setAvailableFalse();
						exam.setStartTime(start);
						for(Hour end : day.getHours()) {
							if(end.getAvailable() == true) {
								if(end.getHour() - start.getHour() == exam.getDuration()) {
									exam.setEndTime(end);
									exam.setDay(day);
									removeHours(exam);
									exam = exam.returnBlank();
									return true;
								}
							end.setAvailableFalse();
						}
						}
					}
				}
		 }
		 
		 return false;
	 }
	 
	
	public Boolean book(Exam exam) {
		if(exam.getScheduled() != true) {
			for(Day day : allDays) {
				for(Hour start : day.getHours()) {
					if(start.getAvailable() == true) {
						start.setAvailableFalse();
						exam.setStartTime(start);
						for(Hour end : day.getHours()) {
							if(end.getAvailable() == true) {
								if(end.getHour() - start.getHour() == exam.getDuration()) {
									exam.setEndTime(end);
									exam.setScheduledTrue();
									exam.setDay(day);
									return true;
								}
							end.setAvailableFalse();
						}
					}
				}
			}
		}
	}
		return false;
}


}
